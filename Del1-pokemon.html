<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokedex</title>
  </head>
  <body>
    <h1>The Pokedex</h1>

    <!-- knapp for å lage ny pokemon -->
    <button onclick="developNewPokemon()">Develop new Pokémon</button>

    <!-- container for pokemonkort-->

    <div id="selectedPokemon" class="pokemon-container"></div>

    <!--Rullgarding liste her for filtrering-->
    <select id="typeDropdown" class="type-dropdown" onchange="filterPokemon()">
      <option value="Normal">Normal</option>
      <option value="Fire">Fire</option>
      <option value="Water">Water</option>
      <option value="Electric">Electric</option>
      <option value="Grass">Grass</option>
      <option value="Ice">Ice</option>
      <option value="Fighting">Fighting</option>
      <option value="Poison">Poison</option>
      <option value="Ground">Ground</option>
      <option value="Flying">Flying</option>
      <option value="Psychic">Psychic</option>
      <option value="Bug">Bug</option>
      <option value="Rock">Rock</option>
      <option value="Ghost">Ghost</option>
      <option value="Dragon">Dragon</option>
      <option value="Dark">Dark</option>
      <option value="Steel">Steel</option>
      <option value="Fairy">Fairy</option>
      <option value="Stellar">Stellar</option></select
    ><br />

    <button onclick="developNewPokemon()">Develop new Pokémon</button
    ><br /><br />

    <div id="pokemonDisplay" class="pokemon-container"></div>

    <div id="selectedPokemon" class="pokemon-container"></div>

    <script>
      window.onload = () => {
        fetchAndDisplayRandomPokemon("pokemonDisplay");
      };
      async function fetchRandomPokemon() {
        try {
          const response = await fetch(
            `https://pokeapi.co/api/v2/pokemon?limit=50`
          );
          if (!response.ok) {
            throw new Error("Failed to fetch random Pokemon");
          }
          const data = await response.json();
          return data.results;
        } catch (error) {
          console.error(error);
        }
      }

      async function fetchAndDisplayRandomPokemon(containerId) {
        const pokemons = await fetchRandomPokemon();
        const pokemonDisplay = document.getElementById(containerId);
        pokemonDisplay.innerHTML = "";

        pokemons.forEach(async (pokemon, index) => {
          const response = await fetch(pokemon.url);
          const data = await response.json();
          const primaryType = data.types[0].type.name;
          const card = createPokemonCard(
            data.name,
            //her brukte jeg front_default men fristet veldig med shiny versjoner også//
            data.sprites.front_default,
            primaryType,
            containerId
          );

          pokemonDisplay.appendChild(card);
        });
      }
      // lage nytt pokemonkort funksjon
      function createPokemonCard(name, sprite, type, containerId) {
        const card = document.createElement("div");
        card.classList.add("pokemon-card");
        card.innerHTML = `
            <h2>${name}</h2>
            <p>Type: ${type}</p>
            <img src="${sprite}" alt="Pokemon Sprite" class="pokemon-image">
            <button onclick="addPokemon('${name}', '${sprite}', '${type}', '${containerId}')">SAVE</button>
            <button class="delete-button" onclick="deletePokemon(this)">X</button>
            <button class="edit-button" onclick="editPokemon(this)">Edit</button>
        `;

        card.style.backgroundColor = getColorForType(type);
        return card;
      }

      // Vi legger til pokemon i lista vår
      function addPokemon(name, sprite, type, containerId) {
        const selectedPokemon = document.getElementById("selectedPokemon");
        const currentPokemonCount =
          selectedPokemon.querySelectorAll(".pokemon-card").length;

        if (currentPokemonCount < 5) {
          const card = createPokemonCard(name, sprite, type, containerId);
          selectedPokemon.appendChild(card);

          // funksjon for å fjerne kort, måtte google meg fremt til funksjonen .closest, 
          //benyttet link: https://www.geeksforgeeks.org/jquery-closest-method/ for å lære mer om dette

          const displayArea = document.getElementById(containerId);
          const cardToRemove = card.closest(".pokemon-card");

          if (displayArea.contains(cardToRemove)) {
            displayArea.removeChild(cardToRemove);
          }

          // Fra timen om Localstorage i frontend studiet.
          const customPokemon = { name, sprite, type };
          saveCustomPokemon(customPokemon);
        } else {
          alert(
            "Your party is full. Please remove one or more pokemon in your party if you wish to add this one - Professor Oak"
          );
        }
      }

   



    </script>
  </body>
</html>
